<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Blocked</title>
        <link rel="stylesheet" href="blocked.css" />
    </head>

    <body>
        <div class="bg"></div>

        <main class="wrap">
        <section class="card">
            <div class="badge">Time limit reached</div>

            <h1>Site blocked</h1>

            <p class="lead">
            You've hit your limit for
            <span id="domain" class="domain">this site</span>
            </p>

            <div class="actions">
            <button id="goBackBtn" class="btn ghost" type="button">Go back</button>
            <button id="closeTabBtn" class="btn" type="button">Close tab</button>
            </div>
        </section>
        </main>

        <script>
            const params = new URLSearchParams(location.search);
            const d = params.get("d") || "this site";
            document.getElementById("domain").textContent = d;

            async function goSomewhereSafe() {
                // If back doesn't work, send them to a safe page.
                await chrome.tabs.update({ url: "chrome://newtab" });
            }

            document.getElementById("goBackBtn").addEventListener("click", async () => {
                // Try back first; if it doesn't change the page quickly, fallback.
                const before = location.href;
                history.back();
                setTimeout(() => {
                    if (location.href === before) goSomewhereSafe();
                }, 200);
            });

            document.getElementById("closeTabBtn").addEventListener("click", async () => {
                const tab = await chrome.tabs.getCurrent();
                if (tab?.id != null) chrome.tabs.remove(tab.id);
            });
        </script>
  </body>
</html>
